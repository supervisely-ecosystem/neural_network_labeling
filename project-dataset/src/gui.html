<div>
    <div class="fflex" style="align-items: stretch">
        <sly-card title="Input" style="width: 50%" class="mr15">
            <sly-field title="" description="Project">
                <a slot="title" target="_blank"
                   :href="`/projects/${data.projectId}/datasets`">{{data.projectName}} ({{data.projectItemsCount}}
                    images)</a>
                <sly-icon slot="icon" :options="{ imageUrl: `${data.projectPreviewUrl}` }"/>
            </sly-field>
        </sly-card>

        <sly-card title="Output" style="width: 50%">
            <sly-field :v-if="data.resProjectId" title="" description="Project">
                <a slot="title" target="_blank"
                   :href="`/projects/${data.resProjectId}/datasets`">{{data.resProjectName}}</a>
                <sly-icon slot="icon" :options="{ imageUrl: `${data.resProjectPreviewUrl}` }"/>
            </sly-field>
        </sly-card>
    </div>

    <div class="fflex mt15" style="align-items: stretch;">
        <sly-card title="Settings" style="width: 50%" class="mr15">
            <div v-if="data.connected === false">
                <sly-field title="Connect to running NN"
                           description="Define session (task id) with deployed model">
                    <sly-icon slot="icon" :options="{ color: '#2cd26e', bgColor: '#d8f8e7', rounded: false }">
                        <i class="zmdi zmdi-compass"></i>
                    </sly-icon>
                    <div class="fflex">
                        <sly-select-app-session :group-id="data.teamId"
                                                :app-session-id.sync="state.sessionId"
                                                :options="data.ssOptions">
                        </sly-select-app-session>
                        <el-button class="ml5"
                                   type="primary"
                                   :disabled="!state.sessionId"
                                   @click="command('connect')"
                        >
                            <i class="zmdi zmdi-refresh mr5"></i> Connect
                        </el-button>
                    </div>
                </sly-field>
                <sly-notification
                        v-if="data.connectionError.length > 0"
                        :options="{'name': 'Connection Error', 'type': 'error'}"
                        :content="data.connectionError">
                </sly-notification>
            </div>
            <div v-if="data.connected === true">
                <el-tabs v-model="state.tabName">
                    <el-tab-pane label="Info" name="info">
                        <span slot="label"><i class="zmdi zmdi-info mr5"></i>Info</span>
                        <div v-for="v,k in data.info" class="mb5" style="word-break: break-all;">
                            <b style="color: #777777;">{{k}}</b>: {{v}}
                        </div>
                        <el-button type="warning" class="mt5" @click="command('disconnect')">
                            <i class="zmdi zmdi-close mr5"></i>Disconnect
                        </el-button>
                    </el-tab-pane>
                    <el-tab-pane label="Classes" name="classes">
                        <span slot="label"><i class="zmdi zmdi-shape mr5"></i>Classes</span>
                        <div v-if="state.classesInfo.length === 0">Model does not produce classes</div>
                        <div v-if="state.classesInfo.length > 0">
                            <div class="mb10">Choose model classes that should be kept, other classes will be skipped
                            </div>
                            <div class="fflex">
                                <el-button type="text" size="mini" @click="command('select_all_classes');">
                                    <i class="zmdi zmdi-check-all"></i> Select all
                                </el-button>
                                <el-button type="text" size="mini" @click="command('deselect_all_classes');"
                                           style="margin-left: 25px;">
                                    <i class="zmdi zmdi-square-o"></i> Deselect all
                                </el-button>
                            </div>
                            <table>
                                <tbody>
                                <tr v-for="(objClass, index) in state.classesInfo">
                                    <td>
                                        <el-checkbox class="small" v-model="state.classes[index]"></el-checkbox>
                                    </td>
                                    <td><i class="zmdi zmdi-circle ml5 mr5" :style="{color: objClass.color}"></i></td>
                                    <td><b style="color: #777777">{{objClass.title}}</b></td>
                                    <td><span class="ml5">{{objClass.shape}}</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Tags" name="tags">
                        <span slot="label"><i class="zmdi zmdi-label mr5"></i>Tags</span>
                        <div v-if="state.tagsInfo.length === 0">Model does not produce tags</div>
                        <div v-if="state.tagsInfo.length > 0">
                            <div class="mb10">Choose model tags that should be kept, other tags will be skipped</div>
                            <div class="fflex">
                                <el-button type="text" size="mini" @click="command('select_all_tags');">
                                    <i class="zmdi zmdi-check-all"></i> Select all
                                </el-button>
                                <el-button type="text" size="mini" @click="command('deselect_all_tags');"
                                           style="margin-left: 25px;">
                                    <i class="zmdi zmdi-square-o"></i> Deselect all
                                </el-button>
                            </div>
                            <table>
                                <tbody>
                                <tr v-for="(tagMeta, index) in state.tagsInfo">
                                    <td>
                                        <el-checkbox class="small" v-model="state.tags[index]"></el-checkbox>
                                    </td>
                                    <td><i class="zmdi zmdi-label ml5 mr5" :style="{color: tagMeta.color}"></i></td>
                                    <td><b style="color: #777777">{{tagMeta.name}}</b></td>
                                    <td><span class="ml5">{{tagMeta['value_type']}}</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Inference" name="inference">
                        <span slot="label"><i class="zmdi zmdi-settings mr5"></i></i>Inference</span>

                        <div class="mb15">
                            <div><b>Mode</b></div>
                            <el-select v-model="state.infMode">
                                <el-option key="full image" label="full image" value="fi"></el-option>
                                <el-option key="roi"
                                           label="roi (image region) - coming soon"
                                           value="roi"
                                           :disabled="true">
                                </el-option>
                                <el-option key="sw"
                                           label="sliding window - coming soon"
                                           value="sw"
                                           :disabled="true">
                                </el-option>
                            </el-select>
                        </div>

                        <div class="mb15">
                            <div><b>Class/tag name suffix</b></div>
                            <div>Add suffix to model class/tag name if it has conflicts with existing one</div>
                            <el-input placeholder="Please input" v-model="state.suffix"></el-input>
                        </div>

                        <div class="mb15">
                            <div><b>How to add predictions</b></div>
                            <el-select v-model="state.addMode">
                                <el-option key="merge" label="merge" value="merge"></el-option>
                                <el-option key="replace" label="replace" value="replace"></el-option>
                            </el-select>
                        </div>


                        <sly-field title="Settings"
                                   description="Model specific inference settings in YAML format">
                            <sly-editor v-model="state.settings"
                                        :options="{height: '200px', mode: 'ace/mode/yaml'}"></sly-editor>
                        </sly-field>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </sly-card>
        <sly-card title="Preview on random image" subtitle="123" style="width: 50%" >
            XXX
            <div slot="header">
                <el-button type="primary" @click="command('preview')">
                    <i class="zmdi zmdi-grid" style="margin-right: 5px"></i> Preview
                </el-button>
            </div>
            <sly-grid-gallery v-if="data.previewProgress === 100" :content="data.preview.content"
                              :options="data.preview.options"/>
        </sly-card>
    </div>
</div>